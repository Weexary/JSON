^(.*)"municipal": "(.*"province": "CAR, Abra".*)$
$1"municipal": "ABR, $2
WITH BCARDP AS
	(SELECT
		*
	 FROM REPATOS..BOCADCARDP
	 WHERE UPLOAD_DATE = DATEADD (MONTH, DATEDIFF (MONTH, 1, GETDATE ()) - 0, 0)
		AND CARD_PDT_NBR in (SELECT card_product 
				             FROM REPATOS..BOCAD_PRODUCTS
					         WHERE CARD_TYPE = 'CREDITCARD')
	),
	BCACCP AS
	(SELECT 
		*
	 FROM REPATOS..BOCADCACCP
	 WHERE UPLOAD_DATE = DATEADD (MONTH, DATEDIFF (MONTH, 1, GETDATE ()) - 0, 0)
		AND CRDACCT_PDT_NBR in (SELECT card_product 
								FROM REPATOS..BOCAD_PRODUCTS
								WHERE CARD_TYPE = 'CREDITCARD')
	--),
	--BCUSTP AS
	--(SELECT
	--	CASE
	--	WHEN CUST_DTE_BIRTH = 0 THEN NULL
	--	WHEN LEN(CUST_DTE_BIRTH) = 7 AND LEFT(CUST_DTE_BIRTH,1) = 1 THEN dbo.fn_convertJulian(CUST_DTE_BIRTH)
	--	WHEN LEN(CUST_DTE_BIRTH) = 7 AND LEFT(CUST_DTE_BIRTH,1) = 9 THEN CAST(CONCAT( 
	--																	 SUBSTRING('1'+CAST(CUST_DTE_BIRTH AS varchar),1,4),'-',
	--																	 SUBSTRING('1'+CAST(CUST_DTE_BIRTH AS varchar),5,2),'-',
	--																	 SUBSTRING('1'+CAST(CUST_DTE_BIRTH AS varchar),7,2)
	--																	 ) AS DATE)
	--	ELSE  CAST(CONCAT( 
	--		  SUBSTRING(CAST(CUST_DTE_BIRTH AS varchar),1,4),'-',
	--		  SUBSTRING(CAST(CUST_DTE_BIRTH AS varchar),5,2),'-',
	--		  SUBSTRING(CAST(CUST_DTE_BIRTH AS varchar),7,2)
	--		  ) AS DATE)
	--	END AS birth_date,
	--	*
	-- FROM REPATOS..BOCADCUSTP
	-- WHERE UPLOAD_DATE = DATEADD (MONTH, DATEDIFF (MONTH, 1, GETDATE ()) - 0, 0)
	 )--, result AS(
	 SELECT --DISTINCT
	cust.CUST_CIF_NBR AS 'CIF NO',
	LTRIM(RTRIM(cust.CUST_FIRST_NAME)) + ' ' + LTRIM(RTRIM(cust.CUST_MIDDLE_NAME))+ ' '+ LTRIM(RTRIM(cust.CUST_LAST_NAME)) AS 'NAME',
	card.CARD_SUP_REL AS 'CARD_SUP_REL',
	card.CARD_NBR AS  'CARD_NUMBER',
	--account.CRDACCT_NBR,
	--transactions.TXN_ACCT_NBR,
	--transactions.TXN_CARD_NBR,
	CAST(CONCAT( 
		   SUBSTRING(CAST(transactions.TXN_DTE AS varchar),1,4),'-',
		   SUBSTRING(CAST(transactions.TXN_DTE AS varchar),5,2),'-',
		   SUBSTRING(CAST(transactions.TXN_DTE AS varchar),7,2)
		   ) AS DATE) AS 'DATE_OF_SWIPE',
	transactions.TXN_DESC AS 'TRANSACTION_DESCRIPTION',
	transactions.TXN_CODE AS 'TRANSCODE',
	CASE	
		WHEN transactions.TXN_CURR_CODE = '608' THEN 'PHP' 
		WHEN transactions.TXN_CURR_CODE = '840' THEN 'USD'
	ELSE NULL
	END AS 'CURRENCY',
	transactions.TXN_AMT AS 'TRANSACTION_AMOUNT',
	card.CARD_STATUS AS 'CARD_STATUS',
	CASE 
		WHEN card.CARD_STATUS = '1' OR card.CARD_STATUS = '2' THEN 'Active'
		WHEN card.CARD_STATUS = '4' THEN 'Lost'
		WHEN card.CARD_STATUS = 'U' THEN 'Upgraded'
		WHEN card.CARD_STATUS = '8' THEN 'Closed'
		ELSE card.CARD_STATUS
	END AS 'CARD_STS_DESC',
	product.PROD_DESC AS 'CARD_PRODUCT_TYPE',
	transactions.[TXN_PDT_NBR ] AS 'CARD_PRODUCT_CODE',
	mcc.MCC_DESC AS 'MERCHANT_NAME',
	transactions.TXN_MCC_CODE AS 'MERCHANT CODE',
	CASE
		WHEN DATEPART(DAYOFYEAR, GETDATE()) < DATEPART(DAYOFYEAR, cust.birth_date) THEN DATEDIFF(YEAR, cust.birth_date, GETDATE()) - 1
		ELSE DATEDIFF(YEAR, cust.birth_date, GETDATE())
	END AS 'AGE',
	CASE
			WHEN cust.CUST_SEX = 0 THEN 'Male'
			WHEN cust.CUST_SEX = 1 THEN 'Female'
			WHEN cust.CUST_SEX = 2 THEN 'Unknown'
			ELSE CAST(cust.CUST_SEX AS varchar)
	END AS 'GENDER',
	CASE
			WHEN cust.CUST_MARITAL_ST = 0 THEN 'Single'
			WHEN cust.CUST_MARITAL_ST = 1 THEN 'Married'
			WHEN cust.CUST_MARITAL_ST = 2 THEN 'Divorced'
			WHEN cust.CUST_MARITAL_ST = 3 THEN 'Widowed'
			WHEN cust.CUST_MARITAL_ST = 4 THEN 'Separated'
			ELSE CAST(cust.CUST_MARITAL_ST AS varchar)
	END AS 'MARITAL STATUS',
	cust.CUST_ADD_PROVINCE AS 'PROVINCE',
	transactions.TXN_POS_ENTRY_MODE AS 'POS ENTRY MODE'
	--cust.province
	INTO credit_merchant_2022
FROM REPATOS..BOCCTDTP AS transactions
LEFT JOIN BCARDP AS card
	ON card.CARD_NBR = transactions.TXN_CARD_NBR
LEFT JOIN BCACCP AS account
	ON account.CRDACCT_NBR = card.CARD_ACCT_NBR
LEFT JOIN customery AS cust
	ON cust.CUST_NBR = account.CRDACCT_CUST_NBR
LEFT JOIN REPATOS..BOCAD_PRODUCTS AS product
	ON product.CARD_PRODUCT = card.CARD_PDT_NBR
LEFT JOIN REPATOS..BOCAD_MCC AS mcc
	ON mcc.MCC_CODE = transactions.TXN_MCC_CODE
WHERE transactions.TXN_PDT_NBR in (SELECT CARD_PRODUCT FROM REPATOS..BOCAD_PRODUCTS WHERE CARD_TYPE = 'CREDITCARD')
  AND transactions.TXN_DTE BETWEEN 20220101 AND 20220331
  AND transactions.TXN_MCC_CODE <> '0'
--	AND transactions.TXN_PDT_NBR in (SELECT CARD_PRODUCT FROM REPATOS..BOCAD_PRODUCTS WHERE CARD_TYPE = 'CREDITCARD')
--ORDER BY 1
	--AND transactions.TXN_DESC LIKE '%CASH advance%' --4295137437.31
--)
--SELECT
--*
--FROM result
--ORDER BY 15,5
--SELECT --TOP(10)
--MERCHANT_NAME,
--COUNT(MERCHANT_NAME) AS 'TOTAL COUNT',
--sum(TRANSACTION_AMOUNT) AS 'TOTAL TRANSACTION AMOUNT'
--FROM result
--WHERE MERCHANT_NAME = 'Grocery Stores and Supermarkets'
--GROUP BY MERCHANT_NAME
--
--select
--*
--from transacts
----
--SELECT
--*
--FROM REPATOS..BOCADAPPMP_VW
--WHERE APPM_ACC_DCL_IND = ' '
--ORDER BY 2
-- --APPM_ACC_DCL_IND IS NULL
--SELECT
--COUNT(transactions.txn_amt)
--FROM REPATOS..BOCCTDTP AS transactions
--WHERE transactions.TXN_DTE BETWEEN 20220101 AND 20221231
--AND (transactions.TXN_DESC LIKE '%SM%STORE%' OR transactions.TXN_DESC LIKE '%SM%HYPERMARKET%' OR transactions.TXN_DESC LIKE '%SM%SUPERMARKET%' OR transactions.TXN_DESC LIKE '%SM%MARKET%')
--AND transactions.TXN_PDT_NBR in (SELECT CARD_PRODUCT FROM REPATOS..BOCAD_PRODUCTS WHERE CARD_TYPE = 'DEBITCARD')

--SELECT TOP(10)
--	*
--FROM REPATOS..BOCCTDTP
--
--SELECT DATEADD(MONTH, -1, CAST(GETDATE() AS DATE))
--SELECT
--COUNT(transactions.txn_amt) AS total_count,
--SUM(transactions.txn_amt) AS total_amt
--FROM REPATOS..BOCCTDTP AS transactions
--WHERE txn_mcc_code = '5411'
--AND [TXN_DTE ] between 20220101 AND 20221231
--AND txn_pdt_nbr in (SELECT CARD_PRODUCT FROM REPATOS..BOCAD_PRODUCTS WHERE CARD_TYPE = 'DEBITCARD')
